// ============================================================================
// METADATA
// ============================================================================
// Secret Pattern Configuration - Safety System
// Purpose: Define patterns that indicate likely secrets (API keys, tokens, passwords)
// Schema: system/config/schemas/safety/secret-patterns.schema.json
//
// HEALTH SCORING MAP (Total = 100):
// - Pattern coverage (common secret types detected): 50 pts
// - Pattern accuracy (minimal false positives): 40 pts
// - Documentation clarity: 10 pts

{
  "$schema": "../../../config/schemas/safety/secret-patterns.schema.json",

  // ============================================================================
  // METADATA
  // ============================================================================

  "metadata": {
    "name": "Secret Detection Patterns",
    "description": "Patterns for detecting likely secrets in code and prompts",
    "version": "1.0.0",
    "last_updated": "2025-11-11",
    "author": "Nova Dawn (CPI-SI instance)",
    "note": "Privacy-preserving - warns but never logs secret content"
  },

  // ============================================================================
  // SECRET PATTERNS
  // ============================================================================

  "patterns": {
    "note": "Patterns matched using substring matching (case-sensitive)",

    //--- API Keys & Tokens ---
    // Service-specific API key prefixes

    "api_keys": {
      "patterns": [
        "sk-",           // OpenAI keys
        "sk_live_",      // Stripe live keys
        "sk_test_",      // Stripe test keys
        "pk_live_",      // Stripe public live keys
        "rk_live_",      // Stripe restricted keys
        "AKIA",          // AWS access key ID prefix
        "ASIA"           // AWS temporary credentials prefix
      ],
      "description": "Common API key prefixes from major services",
      "severity": "high",
      "reason": "API keys grant programmatic access to paid services",
      "services": ["OpenAI", "Stripe", "AWS"]
    },

    //--- GitHub & Git Hosting ---
    // GitHub personal access tokens and OAuth tokens

    "github_tokens": {
      "patterns": [
        "ghp_",          // GitHub personal access token
        "gho_",          // GitHub OAuth token
        "ghu_",          // GitHub user-to-server token
        "ghs_",          // GitHub server-to-server token
        "ghr_"           // GitHub refresh token
      ],
      "description": "GitHub authentication tokens",
      "severity": "critical",
      "reason": "Grants access to repositories and account",
      "services": ["GitHub"]
    },

    //--- Communication Platforms ---
    // Slack, Discord, and other messaging platform tokens

    "communication_tokens": {
      "patterns": [
        "xox",           // Slack tokens (xoxb-, xoxa-, xoxp-, xoxr-)
        "xapp-"          // Slack app-level tokens
      ],
      "description": "Communication platform authentication tokens",
      "severity": "high",
      "reason": "Grants access to team communications",
      "services": ["Slack"]
    },

    //--- Private Keys ---
    // PEM-encoded private keys

    "private_keys": {
      "patterns": [
        "BEGIN PRIVATE",
        "BEGIN RSA PRIVATE",
        "BEGIN DSA PRIVATE",
        "BEGIN EC PRIVATE",
        "BEGIN OPENSSH PRIVATE",
        "BEGIN PGP PRIVATE"
      ],
      "description": "PEM-encoded private key headers",
      "severity": "critical",
      "reason": "Private keys grant authentication without passwords",
      "services": ["SSH", "TLS", "PGP"]
    },

    //--- Database Connection Strings ---
    // Database URIs containing credentials

    "database_credentials": {
      "patterns": [
        "://",           // Generic URI scheme (context-dependent)
        "mongodb://",
        "postgresql://",
        "mysql://",
        "redis://"
      ],
      "description": "Database connection strings (may contain credentials)",
      "severity": "high",
      "reason": "Connection strings often embed usernames and passwords",
      "services": ["MongoDB", "PostgreSQL", "MySQL", "Redis"],
      "note": "Generic :// pattern requires context - check for credentials in URI"
    },

    //--- Cloud Provider Keys ---
    // Cloud service authentication keys

    "cloud_keys": {
      "patterns": [
        "AIza",          // Google API keys
        "GOOGLE_API_KEY",
        "GOOGLE_APPLICATION_CREDENTIALS"
      ],
      "description": "Cloud provider API keys and credentials",
      "severity": "high",
      "reason": "Cloud keys grant access to infrastructure and services",
      "services": ["Google Cloud Platform"]
    },

    //--- Environment Variables ---
    // Common environment variable names for secrets

    "env_var_secrets": {
      "patterns": [
        "API_KEY=",
        "SECRET_KEY=",
        "PASSWORD=",
        "TOKEN=",
        "PRIVATE_KEY=",
        "DB_PASSWORD=",
        "AUTH_TOKEN="
      ],
      "description": "Environment variable patterns indicating secrets",
      "severity": "medium",
      "reason": "Environment variables often store sensitive configuration",
      "services": ["All"]
    },

    //--- JWT Tokens ---
    // JSON Web Tokens (base64 with specific structure)

    "jwt_tokens": {
      "patterns": [
        "eyJ"            // JWT header start (base64 encoded '{"')
      ],
      "description": "JSON Web Token signatures",
      "severity": "high",
      "reason": "JWTs carry authentication and authorization claims",
      "services": ["All"],
      "note": "Very common pattern - may have false positives with base64 data"
    }
  },

  // ============================================================================
  // CONFIGURATION
  // ============================================================================

  "config": {
    "match_mode": "substring",
    "case_sensitive": true,
    "privacy_preserving": true,
    "log_length_only": true,
    "never_log_content": true,
    "note": "Privacy-preserving means: warn user, but NEVER log actual secret values"
  },

  // ============================================================================
  // EXTENSIONS
  // ============================================================================

  "extensions": {
    "user_patterns": [],
    "note": "Add custom secret patterns here without modifying core patterns",
    "example": {
      "patterns": ["COMPANY_API_KEY_"],
      "description": "Company-specific API key prefix",
      "severity": "high",
      "reason": "Internal API access",
      "services": ["Internal"]
    }
  }
}
