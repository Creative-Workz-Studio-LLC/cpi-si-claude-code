{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://cpi-si.org/schemas/temporal/appointed/planner-state.schema.json",
  "title": "Planner State",
  "description": "Schema for planner current view and state tracking",
  "type": "object",
  "required": ["metadata", "current_view", "filters", "navigation", "view_preferences"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "metadata": {
      "type": "object",
      "required": ["component", "version", "last_updated", "purpose"],
      "properties": {
        "component": {
          "type": "string",
          "description": "Component name"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Semantic version"
        },
        "last_updated": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
          "description": "Last update date (YYYY-MM-DD)"
        },
        "purpose": {
          "type": "string",
          "description": "Purpose of this state file"
        }
      }
    },
    "current_view": {
      "type": "object",
      "required": ["mode", "identity_type", "identity_id", "timestamp"],
      "properties": {
        "mode": {
          "type": "string",
          "enum": ["day", "week", "month", "year"],
          "description": "Current view mode"
        },
        "identity_type": {
          "type": "string",
          "enum": ["user", "instance"],
          "description": "Type of identity viewing the planner"
        },
        "identity_id": {
          "type": "string",
          "description": "Unique identifier for the identity"
        },
        "active_week": {
          "type": "string",
          "pattern": "^\\d{4}-W\\d{2}$",
          "description": "Current week being viewed (ISO week format: YYYY-WXX)"
        },
        "active_date": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
          "description": "Specific date if in day view (YYYY-MM-DD)"
        },
        "active_month": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}$",
          "description": "Month if in month view (YYYY-MM)"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when state was last updated"
        }
      }
    },
    "filters": {
      "type": "object",
      "required": ["show_categories", "hide_categories", "show_coordination", "show_personal_only", "show_past", "priority_filter"],
      "properties": {
        "show_categories": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Categories to show (empty = show all)"
        },
        "hide_categories": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Categories to explicitly hide"
        },
        "show_coordination": {
          "type": "boolean",
          "description": "Include coordinated appointments"
        },
        "show_personal_only": {
          "type": "boolean",
          "description": "Show only personal appointments"
        },
        "show_past": {
          "type": "boolean",
          "description": "Include past appointments"
        },
        "priority_filter": {
          "type": "string",
          "enum": ["all", "highest", "high", "medium", "low"],
          "description": "Filter by priority level"
        }
      }
    },
    "navigation": {
      "type": "object",
      "required": ["can_go_back", "can_go_forward"],
      "properties": {
        "can_go_back": {
          "type": "boolean",
          "description": "Is there a previous week/day to navigate to"
        },
        "can_go_forward": {
          "type": "boolean",
          "description": "Is there a next week/day to navigate to"
        },
        "previous_week": {
          "type": "string",
          "pattern": "^\\d{4}-W\\d{2}$",
          "description": "Previous week identifier (ISO week format)"
        },
        "next_week": {
          "type": "string",
          "pattern": "^\\d{4}-W\\d{2}$",
          "description": "Next week identifier (ISO week format)"
        },
        "current_week": {
          "type": "string",
          "pattern": "^\\d{4}-W\\d{2}$",
          "description": "Current week identifier (ISO week format)"
        }
      }
    },
    "view_preferences": {
      "type": "object",
      "required": ["default_view", "week_starts_on", "timezone", "time_format", "show_time_blocks", "compact_mode"],
      "properties": {
        "default_view": {
          "type": "string",
          "enum": ["day", "week", "month", "year"],
          "description": "Default view mode (inherited from config)"
        },
        "week_starts_on": {
          "type": "string",
          "enum": ["monday", "sunday"],
          "description": "First day of the week"
        },
        "timezone": {
          "type": "string",
          "description": "IANA timezone identifier"
        },
        "time_format": {
          "type": "string",
          "enum": ["12h", "24h"],
          "description": "Time format preference"
        },
        "show_time_blocks": {
          "type": "boolean",
          "description": "Enable visual time blocking"
        },
        "compact_mode": {
          "type": "boolean",
          "description": "Use condensed view"
        }
      }
    },
    "extensions": {
      "type": "object",
      "description": "Discovery space for future state tracking"
    }
  }
}
